<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Dataset &#8212; emloop 0.2.1 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/highlight.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Model" href="model.html" />
    <link rel="prev" title="Main Loop" href="main_loop.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          emloop</a>
        <span class="navbar-text navbar-version pull-left"><b>0.2</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../getting_started.html">Getting Started</a></li>
                <li><a href="../tutorial.html">Tutorial</a></li>
                <li><a href="index.html">Advanced</a></li>
                <li><a href="../cli.html">CLI Reference</a></li>
                <li><a href="../emloop/index.html">API Reference</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Pages <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
            
            
            
            
            
          </ul>
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary">
<div class="side_nav">
    <a href="main_loop.html" title="Previous Chapter: Main Loop"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Main Loop</span>
    </a>
    </div>
<div class="side_nav">
    <a href="model.html" title="Next Chapter: Model"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Model &raquo;</span>
    </a>
    </div><ul>
<li><a class="reference internal" href="#">Dataset</a><ul>
<li><a class="reference internal" href="#basedataset">BaseDataset</a></li>
<li><a class="reference internal" href="#data-streams">Data Streams</a></li>
<li><a class="reference internal" href="#additional-methods">Additional Methods</a></li>
<li><a class="reference internal" href="#the-philosophy-of-laziness">The Philosophy of Laziness</a></li>
</ul>
</li>
</ul>

<form action="../search.html" method="get" class="searchbox">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form><div class="side_nav">
	<h4>Related projects</h4>
</div>
<ul class="nav nav-list">
	<li><a href="https://emloop.org">emloop</a></li>
	<li><a href="https://tensorflow.emloop.org">emloop-tensorflow</a></li>
	<li><a href="https://hipipe.org">hipipe (c++)</a></li>
</ul>
        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      
  <div class="section" id="dataset">
<h1>Dataset<a class="headerlink" href="#dataset" title="Permalink to this headline">¶</a></h1>
<p>Dataset is the essential component of every machine learning problem. In fact, the dataset is often the problem itself.
Regardless of sizes, complexities and formats, all datasets are beautiful. At some point, though, we need to
iterate through the data points or <em>examples</em> if you wish.</p>
<p>As a matter of fact, the ability of providing example iterators is the only requirement from <strong>emloop</strong> on datasets.
A dataset used for training has to implement a <code class="docutils literal notranslate"><span class="pre">train_stream</span></code>, in addition to that, any <code class="docutils literal notranslate"><span class="pre">&lt;stream_name&gt;_stream</span></code>
may be used for evaluation.</p>
<p>To make a dataset compatible with <strong>emloop</strong> one must implement a class which complies
to the <a class="reference internal" href="../emloop/emloop.datasets.html#emloop.datasets.AbstractDataset" title="emloop.datasets.AbstractDataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">emloop.datasets.AbstractDataset</span></code></a> concept.
With that, <strong>emloop</strong> can create and manage the dataset for you.</p>
<p>To use the dataset in training, specify its fully-qualified name in <code class="docutils literal notranslate"><span class="pre">dataset</span></code> section of <strong>emloop</strong> configuration
file. See the <a class="reference external" href="config.html">configuration section</a> for more information.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>emloop</strong> datasets are configured from <strong>emloop</strong> configuration files. When creating a dataset,
<strong>emloop</strong> encodes the parameters as YAML string in order to ease interoperability in the case the dataset is
implemented in a different language such as in c++.</p>
</div>
<div class="section" id="basedataset">
<h2>BaseDataset<a class="headerlink" href="#basedataset" title="Permalink to this headline">¶</a></h2>
<p>To write your very first dataset in python, we recommend to inherit from <a class="reference internal" href="../emloop/emloop.datasets.html#emloop.datasets.BaseDataset" title="emloop.datasets.BaseDataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">emloop.datasets.BaseDataset</span></code></a>
as it parses the YAML string automatically. Parsed arguments are passed to the
<a class="reference internal" href="../emloop/emloop.datasets.html#emloop.datasets.BaseDataset._configure_dataset" title="emloop.datasets.BaseDataset._configure_dataset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">emloop.datasets.BaseDataset._configure_dataset()</span></code></a> which is required from you implementation.</p>
<p>To give an example, we ll write a skeleton of <code class="docutils literal notranslate"><span class="pre">MyDataset</span></code> in <code class="docutils literal notranslate"><span class="pre">datasets.my_dataset.py</span></code>:</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">datasets.my_dataset.py</span></code></span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="kn">from</span> <span class="nn">emloop</span> <span class="kn">import</span> <span class="n">BaseDataset</span>

 <span class="k">class</span> <span class="nc">MyDataset</span><span class="p">(</span><span class="n">BaseDataset</span><span class="p">):</span>
     <span class="k">def</span> <span class="nf">_configure_dataset</span><span class="p">(</span><span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">augment</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
       <span class="c1"># ...</span>
</pre></div>
</div>
</div>
<p>This class requires two arguments, <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> and <code class="docutils literal notranslate"><span class="pre">augment</span></code>. Any other argument
is ignored and hidden in the <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code>.</p>
<p>Next, we define the <code class="docutils literal notranslate"><span class="pre">dataset</span></code> section in the config file:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">example usage of <code class="docutils literal notranslate"><span class="pre">MyDataset</span></code> in <strong>emloop</strong> configuration</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">dataset</span><span class="p">:</span>
  <span class="nt">class</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">datasets.MyDataset</span>
  <span class="nt">batch_size</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">16</span>
  <span class="nt">augment</span><span class="p">:</span>
    <span class="nt">rotate</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>     <span class="c1"># enable random rotations</span>
    <span class="nt">blur_prob</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.05</span>  <span class="c1"># probability of blurring</span>
</pre></div>
</div>
</div>
<p>Now given this configuration, <strong>emloop</strong> can find, create and configure new <code class="docutils literal notranslate"><span class="pre">MyDataset</span></code> instance seamlessly.</p>
</div>
<div class="section" id="data-streams">
<h2>Data Streams<a class="headerlink" href="#data-streams" title="Permalink to this headline">¶</a></h2>
<p>In most cases, datasets are quite large and can not be fed to the model as whole. For this reason, <strong>emloop</strong> operates
with streams of so called <em>mini-batches</em>, i.e. small portions of the dataset.
In particular, <strong>emloop</strong> works with data on the following levels:</p>
<ul class="simple">
<li><p><strong>stream</strong> in an iterable of <em>batches</em> (<a class="reference internal" href="../emloop/emloop.html#emloop.Stream" title="emloop.Stream"><code class="xref py py-attr docutils literal notranslate"><span class="pre">emloop.Stream</span></code></a>)</p></li>
<li><p><strong>batch</strong> is a dictionary of <em>stream sources</em> (<code class="xref py py-attr docutils literal notranslate"><span class="pre">emloop.BatchData</span></code>)</p></li>
<li><p><strong>stream source</strong> is a list of example <em>fields</em></p></li>
</ul>
<p>For instance, imagine you are classifying images of animals.
An <em>example</em> in this case would be a tuple of two fields, <em>image</em> and <em>label</em>.</p>
<p>Now, the <em>stream</em> would yield <em>batches</em> with <em>image</em> and <em>label</em> stream sources similar to this one:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text"><em>batch</em> example</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">img1</span><span class="p">,</span> <span class="n">img2</span><span class="p">,</span> <span class="n">img3</span><span class="p">,</span> <span class="n">img4</span><span class="p">],</span>
  <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="s1">&#39;dog&#39;</span><span class="p">,</span> <span class="s1">&#39;rabbit&#39;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>Implementing a <code class="docutils literal notranslate"><span class="pre">&lt;name&gt;_stream</span></code> method which returns <em>stream</em> iterator allows <strong>emloop</strong> to use the respective <em>stream</em>.</p>
<p>When training, <strong>emloop</strong> requires the train <em>stream</em> to be provided by <code class="docutils literal notranslate"><span class="pre">train_stream</span></code> method similar to the following one:</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">train_stream</span></code> method example</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">train_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">load_training_batch</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Analogously, additional methods such as <code class="docutils literal notranslate"><span class="pre">valid_stream</span></code> and <code class="docutils literal notranslate"><span class="pre">test_stream</span></code> can be easily implemented.
If they are registered in the config file under <code class="docutils literal notranslate"><span class="pre">main_loop.extra_streams</span></code>, they will be evaluated
along with the train stream. The configuration may look as follows:</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">configuring extra stream to be evaluated</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">main_loop</span><span class="p">:</span>
  <span class="nt">extra_streams</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">valid</span><span class="p p-Indicator">,</span> <span class="nv">test</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
</div>
<p>The extra streams, however, <em>are not</em> used for training, that is, the model is won`t be updated when it iterates through them.</p>
<p>Finally, <strong>emloop</strong> allows evaluation of any additional <em>stream</em> with  <code class="docutils literal notranslate"><span class="pre">emloop</span> <span class="pre">eval</span> <span class="pre">&lt;stream_name&gt;</span> <span class="pre">..</span></code> command.</p>
</div>
<div class="section" id="additional-methods">
<h2>Additional Methods<a class="headerlink" href="#additional-methods" title="Permalink to this headline">¶</a></h2>
<p>Alongside providing the streams, the dataset may implement additional methods
downloading, validating or visualizing the data.</p>
<p>For example, is can contain a <code class="docutils literal notranslate"><span class="pre">download</span></code> method, which checks whether the dataset has all the data it requires.
If not, it downloads them from the internet/database/drive. These methods may be easily invoked with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>emloop dataset &lt;method-name&gt; &lt;config&gt;
</pre></div>
</div>
<p>Additional useful method could be <code class="docutils literal notranslate"><span class="pre">statistics</span></code>, which would print various statistics of provided data,
plot some figures etc.
Sometimes, we need to split the whole dataset into training, validation and testing sets.
For this purpose, we would implement a <code class="docutils literal notranslate"><span class="pre">split</span></code> function.</p>
<p>The suggested methods are completely arbitrary. The key concept is to keep data-related functions
bundled together in the dataset object, so that one doesn’t need to implement
several separate scripts for fetching/visualization/statistics etc.</p>
<p>A typical pipeline contains the following commands.
We leave them without further comments as they are self-describing.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">emloop</span> <span class="pre">dataset</span> <span class="pre">download</span> <span class="pre">config/my-data.yaml</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">emloop</span> <span class="pre">dataset</span> <span class="pre">validate</span> <span class="pre">config/my-data.yaml</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">emloop</span> <span class="pre">dataset</span> <span class="pre">print_statistics</span> <span class="pre">config/my-data.yaml</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">emloop</span> <span class="pre">dataset</span> <span class="pre">plot_histogram</span> <span class="pre">config/my-data.yaml</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">emloop</span> <span class="pre">train</span> <span class="pre">config/my-data.yaml</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">emloop</span> <span class="pre">eval</span> <span class="pre">test</span> <span class="pre">log/my-model</span></code></p></li>
</ul>
</div>
<div class="section" id="the-philosophy-of-laziness">
<h2>The Philosophy of Laziness<a class="headerlink" href="#the-philosophy-of-laziness" title="Permalink to this headline">¶</a></h2>
<p>In our experience, the best practice for the dataset is to perform all the initialization on demand.
This technique is sometimes called <em>lazy initialization</em>.
That is, the constructor should not perform any time-consuming operation such as loading and decoding the data.
Instead, the data should be loaded and decoded in the first moment they are truly necessary (e.g.,
in the <code class="docutils literal notranslate"><span class="pre">train_stream</span></code> method).</p>
<p>The main reason for laziness is that the dataset doesn’t know for which purpose it was constructed.
It might be queried to provide the training data or only to print some simple checksums.
In the cases of extremely big datasets, it is useless and annoying to waste the time by loading the data
without their actual use.</p>
</div>
</div>


    </div>
      
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2018, Iterait a.s..<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.0.1.<br/>
    </p>
  </div>
</footer>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-108491604-2"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-108491604-2');
</script>



  </body>
</html>